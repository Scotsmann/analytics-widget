<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Betting Analytics Dashboard</title>
    <!-- Use Tailwind CSS from a CDN for easy styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Apply a default font and background color */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        /* Style for the loading spinner */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #1a73e8;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-4xl mx-auto space-y-6 m-4">

        <!-- Header Section -->
        <div class="text-center">
            <h1 class="text-4xl font-extrabold text-gray-800 tracking-tight">Betting Analytics Dashboard</h1>
            <p class="mt-2 text-lg text-gray-500">
                Data fetched from the API endpoint: <code class="bg-gray-100 p-1 rounded-md text-sm">https://kompili-ip-analytics-a52176efd7f2.herokuapp.com/analytics</code>
            </p>
        </div>

        <!-- Loading and Error Messages -->
        <div id="loading-spinner" class="flex flex-col items-center justify-center space-y-4">
            <div class="spinner"></div>
            <p class="text-gray-600 font-medium">Loading analytics data...</p>
        </div>

        <div id="error-message" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
            <strong class="font-bold">Error!</strong>
            <span class="block sm:inline" id="error-text">Something went wrong. Please try again later.</span>
        </div>

        <!-- Data Display Section -->
        <div id="data-container" class="mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Data will be rendered here by JavaScript -->
        </div>
    </div>

    <!-- JavaScript to Fetch and Render the Data -->
    <script>
        // Use an immediately invoked function to avoid global variables
        (async function() {
            // Define the API endpoint
            const apiEndpoint = 'https://kompili-ip-analytics-a52176efd7f2.herokuapp.com/analytics';

            // Get references to DOM elements
            const loadingSpinner = document.getElementById('loading-spinner');
            const dataContainer = document.getElementById('data-container');
            const errorMessage = document.getElementById('error-message');
            const errorText = document.getElementById('error-text');

            // Function to show an error message
            function showError(message) {
                loadingSpinner.classList.add('hidden');
                errorMessage.classList.remove('hidden');
                errorText.textContent = message;
            }

            // Function to format numbers for display
            function formatNumber(value) {
                if (typeof value === 'number') {
                    // Check if the number is an integer
                    if (Number.isInteger(value)) {
                        return value;
                    }
                    return value.toFixed(2);
                }
                return value;
            }

            // Function to render the fetched data
            function renderData(data) {
                // Clear any existing content
                dataContainer.innerHTML = '';
                // Check if the data is a valid object
                if (typeof data !== 'object' || data === null) {
                    showError('Invalid data format received from the API.');
                    return;
                }

                // Iterate over the keys in the data object and create cards for each
                for (const key in data) {
                    if (Object.hasOwnProperty.call(data, key)) {
                        // Create a new div for each data point
                        const dataCard = document.createElement('div');
                        dataCard.className = 'bg-white p-6 rounded-xl shadow-sm border border-gray-200';

                        // Create the title of the card from the key
                        const cardTitle = document.createElement('h3');
                        cardTitle.className = 'text-xl font-semibold text-gray-700 capitalize break-words';
                        // Replace underscores with spaces and capitalize the first letter of each word
                        cardTitle.textContent = key.replace(/_/g, ' ');

                        // Create a paragraph for the value
                        const cardValue = document.createElement('p');
                        cardValue.className = 'mt-2 text-3xl font-bold text-blue-600';
                        cardValue.textContent = formatNumber(data[key]);

                        // Append elements to the card and the card to the container
                        dataCard.appendChild(cardTitle);
                        dataCard.appendChild(cardValue);
                        dataContainer.appendChild(dataCard);
                    }
                }
            }

            // Fetch data from the API
            try {
                // Start by showing the loading spinner
                loadingSpinner.classList.remove('hidden');
                dataContainer.classList.add('hidden');
                errorMessage.classList.add('hidden');

                const response = await fetch(apiEndpoint);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                // Check if the response contains the 'data' key as expected
                if (result && result.data) {
                    renderData(result.data);
                } else {
                    throw new Error('API response is missing the "data" key.');
                }

            } catch (error) {
                console.error('Fetch error:', error);
                showError('Failed to fetch data from the API. Please check the endpoint or your network connection.');
            } finally {
                // Hide the loading spinner regardless of success or failure
                loadingSpinner.classList.add('hidden');
                dataContainer.classList.remove('hidden');
            }
        })();
    </script>
</body>
</html>
